<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar - Project</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="project-page.css">
    

</head>
<body>
    <!-- Image Center Popup -->
    <div class="image-center-popup" id="image-popup">
        <!-- DRAG ZONE: Navigation bar (draggable) -->
        <div class="popup-nav" id="popup-nav">
            <ul class="wrapper-actions">
                <li class="popup-actions popup-close" id="popup-close"></li>
                <li class="popup-actions popup-minimise" id="popup-minimise"></li>
                <li class="popup-actions popup-expand" id="popup-expand"></li>
            </ul>
            <span id="popup-filename"></span>
            <!-- Draggable area - excludes corners like native macOS -->
            <div class="draggable-area"></div>
        </div>
        
        <!-- RESIZE ZONE: Image container (resizable from corners) -->
        <div class="popup-image-container" id="popup-image-container">
            <picture>
                <img id="popup-image" src="" alt="">
            </picture>
        </div>
        
        <!-- RESIZE HANDLES: Four corner resize areas - positioned relative to popup container -->
        <div class="resize-handle resize-handle-nw" id="resize-nw"></div>
        <div class="resize-handle resize-handle-ne" id="resize-ne"></div>
        <div class="resize-handle resize-handle-sw" id="resize-sw"></div>
        <div class="resize-handle resize-handle-se" id="resize-se"></div>
        
        <!-- NAVIGATION ZONES: Left/right image navigation (isolated) -->
        <div class="popup-nav-left" id="popup-nav-left"></div>
        <div class="popup-nav-right" id="popup-nav-right"></div>
    </div>

    
    <div class="project-page-container">
        <!-- Flower GIF - Bottom Left Corner -->
        <img src="flower.gif" alt="Flower" class="flower-gif">
        
        <!-- Header Section - Simple structure for project page -->
        <div class="page-header">
            <div class="page-content">
                <h1 class="name-text" id="project-header">
                    <a href="index.html" class="name-link">
                        <span>I</span><span>S</span><span>H</span><span>A</span> <span>K</span><span>U</span><span>M</span><span>A</span><span>R</span>
                    </a><span class="slash">/</span>
                    <a href="#" class="name-link active">
                        <span>C</span><span>A</span><span>L</span><span>E</span><span>N</span><span>D</span><span>A</span><span>R</span>
                    </a>
                    <span class="project-year">2024 - 2025</span>
                </h1>
            </div>
        </div>
        
        <!-- PROJECT CONTENT AREA -->
        <!-- Add your project content here with clear, defined styling -->
        <section class="project-content-area">
            <div class="project-text-block">
                <p class="project-description">
                    I currently design for Slack's Productivity Team. Our goal is to expand the value of Slack beyond messaging. From 2024 to 2025, our team worked to imagine and engineer a native Calendar experience in Slack.
                </p>
                <p class="project-description">
                    Calendar aims to integrate all your tools & data into a single, unified layer that allows you to manage all the things competing for your time. I contributed several elements of the visual design, and Ied design strategy to create an overall vision for the project. We wanted the experience to feel powerful, and playful â€” true to Slack's personality and promise.
                </p>
            </div>
            <div class="project-credits">
                <p class="credits-text">
                    Many thanks to Samuel Kang, Amanda Glanz, Timothy Wittig, Ford St. John, Elyse Vest, Parag Shah, Stewart Taylor, and Stuart Lovinggood for their talent and time.
                </p>
            </div>
        </section>
        
        <!-- Project Images Work Container -->
        <section class="project-images-section">
            <ul class="image-list">
                <li class="image">
                    <div class="wrapper-image">
                        <img src="project-images/Detail View.png" alt="Detail View">
                    </div>
                    <div class="title">
                        <span>Detail View.png</span>
                    </div>
                </li>
                <li class="image">
                    <div class="wrapper-image">
                        <img src="project-images/Scheduling.png" alt="Scheduling">
                    </div>
                    <div class="title">
                        <span>Scheduling.png</span>
                    </div>
                </li>
                <li class="image">
                    <div class="wrapper-image">
                        <img src="project-images/Special Events.png" alt="Special Events">
                    </div>
                    <div class="title">
                        <span>Special Events.png</span>
                    </div>
                </li>
                <li class="image">
                    <div class="wrapper-image">
                        <img src="project-images/Focus Mode.png" alt="Focus Mode">
                    </div>
                    <div class="title">
                        <span>Focus Mode.png</span>
                    </div>
                </li>
                <li class="image">
                    <div class="wrapper-image">
                        <img src="project-images/Out of Office.png" alt="Out of Office">
                    </div>
                    <div class="title">
                        <span>Out of Office.png</span>
                    </div>
                </li>
                <li class="image">
                    <div class="wrapper-image">
                        <img src="project-images/Create Event.png" alt="Create Event">
                    </div>
                    <div class="title">
                        <span>Create Event.png</span>
                    </div>
                </li>
                <li class="image">
                    <div class="wrapper-image">
                        <img src="project-images/Project Timelines.png" alt="Project Timelines">
                    </div>
                    <div class="title">
                        <span>Project Timelines.png</span>
                    </div>
                </li>
                <li class="image">
                    <div class="wrapper-image">
                        <img src="project-images/Project Timelines (1).png" alt="Project Timelines 1">
                    </div>
                    <div class="title">
                        <span>Project Timelines (1).png</span>
                    </div>
                </li>
                <li class="image">
                    <div class="wrapper-image">
                        <img src="project-images/Project Timelines (2).png" alt="Project Timelines 2">
                    </div>
                    <div class="title">
                        <span>Project Timelines (2).png</span>
                    </div>
                </li>
                <li class="image">
                    <div class="wrapper-image">
                        <img src="project-images/To Dos (Hover).png" alt="To Dos Hover">
                    </div>
                    <div class="title">
                        <span>To Dos (Hover).png</span>
                    </div>
                </li>
                <li class="image">
                    <div class="wrapper-image">
                        <img src="project-images/Scheduling Detection.png" alt="Scheduling Detection">
                    </div>
                    <div class="title">
                        <span>Scheduling Detection.png</span>
                    </div>
                </li>
                <li class="image">
                    <div class="wrapper-image">
                        <img src="project-images/Notifications.png" alt="Notifications">
                    </div>
                    <div class="title">
                        <span>Notifications.png</span>
                    </div>
                </li>
                <li class="image">
                    <div class="wrapper-image">
                        <img src="project-images/Meeting Unfurl.png" alt="Meeting Unfurl">
                    </div>
                    <div class="title">
                        <span>Meeting Unfurl.png</span>
                    </div>
                </li>
                <li class="image">
                    <div class="wrapper-image">
                        <img src="project-images/Day View.png" alt="Day View">
                    </div>
                    <div class="title">
                        <span>Day View.png</span>
                    </div>
                </li>
                <li class="image">
                    <div class="wrapper-image">
                        <img src="project-images/AI Scheduling.png" alt="AI Scheduling">
                    </div>
                    <div class="title">
                        <span>AI Scheduling.png</span>
                    </div>
                </li>
            </ul>
        </section>
        
        <!-- Dynamic font sizing script -->
        <script>
            function adjustFontSize() {
                const textElements = document.querySelectorAll('.project-description');
                const viewportHeight = window.innerHeight;
                const headerHeight = document.querySelector('.page-header').offsetHeight;
                const margins = 80; // 40px top + 40px bottom = 80px
                const availableHeight = viewportHeight - headerHeight - margins;
                
                // Start with a large font size and reduce until it fits
                let fontSize = 100;
                
                // Apply font size to all paragraphs
                textElements.forEach(element => {
                    element.style.fontSize = fontSize + 'px';
                });
                
                // Check if the entire text block fits
                const textBlock = document.querySelector('.project-text-block');
                while (textBlock.scrollHeight > availableHeight && fontSize > 8) {
                    fontSize -= 1;
                    textElements.forEach(element => {
                        element.style.fontSize = fontSize + 'px';
                    });
                }
                
                // Ensure no scrolling by setting a final check
                if (textBlock.scrollHeight > availableHeight) {
                    fontSize = Math.floor(availableHeight / textBlock.scrollHeight * fontSize);
                    textElements.forEach(element => {
                        element.style.fontSize = fontSize + 'px';
                    });
                }
            }
            
            // Project Images Container Scroll Behavior
            function initProjectImagesScroll() {
                const projectImagesSection = document.querySelector('.project-images-section');
                const viewportHeight = window.innerHeight;
                const projectImagesHeight = projectImagesSection.offsetHeight;
                
                // Set initial position: top edge at bottom of viewport
                projectImagesSection.style.top = viewportHeight + 'px';
                
                function updateProjectImagesPosition() {
                    const scrollY = window.pageYOffset;
                    
                    // Calculate scroll progress based on images container height
                    // The text is fixed, so we only need to consider the images container
                    const maxScroll = projectImagesHeight;
                    const scrollProgress = Math.min(scrollY / maxScroll, 1);
                    
                    // Apply easing for smooth movement
                    const easedProgress = 1 - Math.pow(1 - scrollProgress, 3); // easeOutCubic
                    
                    // Calculate new top position
                    // Start: top edge at bottom of viewport (viewportHeight)
                    // End: top edge at top of viewport (0) - so it fills the whole viewport
                    const startTop = viewportHeight;
                    const endTop = 0;
                    const newTop = startTop - (easedProgress * (startTop - endTop));
                    
                    // Apply position with smoothing
                    projectImagesSection.style.top = newTop + 'px';
                }
                
                // Update on scroll
                window.addEventListener('scroll', updateProjectImagesPosition);
                
                // Initial position update
                updateProjectImagesPosition();
            }
            
            // Adjust on load and resize
            window.addEventListener('load', () => {
                adjustFontSize();
                initProjectImagesScroll();
            });
            window.addEventListener('resize', () => {
                adjustFontSize();
                initProjectImagesScroll();
            });
        </script>
        
        <!-- Image Popup Functionality -->
        <script>
            /**
             * macOS-Style Image Popup System
             * 
             * Features:
             * - Draggable navigation bar (macOS-style)
             * - Resizable from four corners
             * - Image navigation (left/right arrows)
             * - Keyboard navigation (arrow keys)
             * - Smooth animations and transitions
             * 
             * Architecture:
             * - Configuration-driven (POPUP_CONFIG)
             * - Utility functions (popupUtils)
             * - Error handling and validation
             * - Self-contained and isolated
             */
            
            // Popup Configuration - Centralized settings
            const POPUP_CONFIG = {
                // Dimensions
                minSize: 200,
                maxSizePercent: 0.95,
                
                // Animation timing
                closeAnimationDuration: 400,
                
                // Z-index values
                popupZIndex: 10000,
                resizeHandleZIndex: 10001,
                navigationZIndex: 9999,
                
                // Navigation area dimensions
                navigationAreaWidth: 60,
                navigationAreaTopOffset: 60
            };
            
            // Get popup elements with error handling
            const imagePopup = document.getElementById('image-popup');
            const popupImage = document.getElementById('popup-image');
            const popupFilename = document.getElementById('popup-filename');
            const popupClose = document.getElementById('popup-close');
            const popupMinimise = document.getElementById('popup-minimise');
            const popupExpand = document.getElementById('popup-expand');
            const popupNavLeft = document.getElementById('popup-nav-left');
            const popupNavRight = document.getElementById('popup-nav-right');
            
            // Validate required elements exist
            if (!imagePopup || !popupImage || !popupFilename || !popupClose) {
                console.error('Required popup elements not found. Popup functionality disabled.');
                throw new Error('Missing required popup elements');
            }
            
            // Get all project images
            const projectImages = document.querySelectorAll('.wrapper-image img');
            
            if (projectImages.length === 0) {
                console.warn('No project images found. Image popup functionality disabled.');
            }
            
            // Popup state management - completely isolated
            let currentImageIndex = 0;
            
            // Store current popup dimensions to preserve them during navigation
            let preservedPopupDimensions = {
                width: null,
                height: null,
                left: null,
                top: null
            };
            
            // Utility functions for common popup operations
            const popupUtils = {
                // Set popup position with bounds checking
                setPosition: (element, x, y) => {
                    const rect = element.getBoundingClientRect();
                    const viewportWidth = window.innerWidth;
                    const viewportHeight = window.innerHeight;
                    
                    // Constrain to viewport bounds
                    const constrainedX = Math.max(0, Math.min(x, viewportWidth - rect.width));
                    const constrainedY = Math.max(0, Math.min(y, viewportHeight - rect.height));
                    
                    element.style.left = constrainedX + 'px';
                    element.style.top = constrainedY + 'px';
                    element.style.transform = 'none';
                },
                
                // Add dragging state to popup
                addDraggingState: (element) => {
                    element.classList.add('dragging');
                },
                
                // Remove dragging state from popup
                removeDraggingState: (element) => {
                    element.classList.remove('dragging');
                },
                
                // Reset popup position for next open
                resetPosition: (element) => {
                    element.style.left = '';
                    element.style.top = '';
                    element.style.transform = '';
                },
                
                // Check if element is within viewport bounds
                isWithinViewport: (element) => {
                    const rect = element.getBoundingClientRect();
                    return rect.top >= 0 && rect.left >= 0 && 
                           rect.bottom <= window.innerHeight && 
                           rect.right <= window.innerWidth;
                }
            };
            
            // Open popup when image is clicked
            if (projectImages.length > 0) {
                projectImages.forEach((img, index) => {
                    img.addEventListener('click', () => {
                        try {
                            // Set current image index
                            currentImageIndex = index;
                            
                            // Get image source and exact filename from title span
                            const imageSrc = img.src;
                            const titleSpan = img.closest('.image')?.querySelector('.title span');
                            const filename = titleSpan ? titleSpan.textContent : 'image.png';
                            
                            // Set popup content
                            popupImage.src = imageSrc;
                            popupImage.alt = img.alt || '';
                            popupFilename.textContent = filename;
                            
                            // Wait for image to load, then show popup
                            popupImage.onload = () => {
                                // Calculate minimum size needed for this image
                                const imageMinSize = calculateMinimumPopupSize();
                                
                                // Get viewport dimensions
                                const viewportWidth = window.innerWidth;
                                const viewportHeight = window.innerHeight;
                                
                                // Smart sizing: Calculate optimal dimensions based on image and viewport
                                const optimalSize = calculateOptimalPopupSize(
                                    popupImage.naturalWidth,
                                    popupImage.naturalHeight,
                                    imageMinSize,
                                    viewportWidth,
                                    viewportHeight
                                );
                                
                                // Set the calculated optimal size
                                imagePopup.style.width = optimalSize.width + 'px';
                                imagePopup.style.height = optimalSize.height + 'px';
                                
                                // Store initial dimensions for preservation during navigation
                                preservedPopupDimensions.width = imagePopup.style.width;
                                preservedPopupDimensions.height = imagePopup.style.height;
                                preservedPopupDimensions.left = imagePopup.style.left;
                                preservedPopupDimensions.top = imagePopup.style.top;
                                
                                // Show popup (CSS already centers it perfectly)
                                imagePopup.classList.add('active');
                            };
                            
                            // If image is already loaded, size immediately
                            if (popupImage.complete) {
                                popupImage.onload();
                            }
                            
                            // Popup is now self-contained - no body changes needed
                        } catch (error) {
                            console.error('Error opening popup:', error);
                        }
                    });
                });
            }
            
            // Close popup ONLY when red X button is clicked
            if (popupClose) {
                popupClose.addEventListener('click', closePopup);
            }
            
            // Minimize button - currently disabled (no functionality)
            if (popupMinimise) {
                popupMinimise.addEventListener('click', () => {
                    // TODO: Implement minimize functionality
                    console.log('Minimize clicked - functionality not implemented yet');
                });
            }
            
            // Expand button - currently disabled (no functionality)
            if (popupExpand) {
                popupExpand.addEventListener('click', () => {
                    // TODO: Implement expand functionality
                    console.log('Expand clicked - functionality not implemented yet');
                });
            }
            
            // Function to close popup
            function closePopup() {
                // Add bouncy exit animation using CSS classes only
                imagePopup.classList.add('closing');
                
                // Wait for animation to complete, then hide popup
                setTimeout(() => {
                    imagePopup.classList.remove('active', 'closing');
                    
                    // Reset popup position for next open using utility
                    popupUtils.resetPosition(imagePopup);
                    
                    // Reset preserved dimensions when popup is closed
                    preservedPopupDimensions = {
                        width: null,
                        height: null,
                        left: null,
                        top: null
                    };
                    
                    // Popup cleanup - no body changes needed
                }, POPUP_CONFIG.closeAnimationDuration);
            }
            
            // Navigation functionality
            function navigateToPreviousImage() {
                if (projectImages.length === 0) return;
                
                if (currentImageIndex > 0) {
                    currentImageIndex--;
                } else {
                    currentImageIndex = projectImages.length - 1; // Wrap to last image
                }
                updatePopupImage();
            }
            
            function navigateToNextImage() {
                if (projectImages.length === 0) return;
                
                if (currentImageIndex < projectImages.length - 1) {
                    currentImageIndex++;
                } else {
                    currentImageIndex = 0; // Wrap to first image
                }
                updatePopupImage();
            }
            
            function updatePopupImage() {
                try {
                    if (projectImages.length === 0) return;
                    
                    // Preserve current popup dimensions and position
                    if (imagePopup.classList.contains('active')) {
                        // Only preserve dimensions if they've been set (not default values)
                        if (imagePopup.style.width && imagePopup.style.width !== '') {
                            preservedPopupDimensions.width = imagePopup.style.width;
                            preservedPopupDimensions.height = imagePopup.style.height;
                            preservedPopupDimensions.left = imagePopup.style.left;
                            preservedPopupDimensions.top = imagePopup.style.top;
                        }
                    }
                    
                    const img = projectImages[currentImageIndex];
                    const titleSpan = img.closest('.image')?.querySelector('.title span');
                    const filename = titleSpan ? titleSpan.textContent : 'image.png';
                    
                    popupImage.src = img.src;
                    popupImage.alt = img.alt || '';
                    popupFilename.textContent = filename;
                    
                    // Restore preserved dimensions after image loads
                    popupImage.onload = () => {
                        if (preservedPopupDimensions.width && preservedPopupDimensions.height) {
                            imagePopup.style.width = preservedPopupDimensions.width;
                            imagePopup.style.height = preservedPopupDimensions.height;
                            imagePopup.style.left = preservedPopupDimensions.left;
                            imagePopup.style.top = preservedPopupDimensions.top;
                        }
                    };
                    
                    // If image is already loaded, restore dimensions immediately
                    if (popupImage.complete) {
                        popupImage.onload();
                    }
                } catch (error) {
                    console.error('Error updating popup image:', error);
                }
            }
            
            // Add navigation event listeners with error handling
            if (popupNavLeft && popupNavRight) {
                popupNavLeft.addEventListener('click', navigateToPreviousImage);
                popupNavRight.addEventListener('click', navigateToNextImage);
            } else {
                console.warn('Navigation areas not found. Image navigation disabled.');
            }
            
            // Keyboard navigation (image switching only)
            document.addEventListener('keydown', (e) => {
                if (imagePopup.classList.contains('active')) {
                    switch (e.key) {
                        case 'ArrowLeft':
                            navigateToPreviousImage();
                            break;
                        case 'ArrowRight':
                            navigateToNextImage();
                            break;
                    }
                }
            });
            
            // Draggable functionality
            let isDragging = false;
            let dragStartX = 0;
            let dragStartY = 0;
            let popupStartX = 0;
            let popupStartY = 0;
            
            // Resizable functionality
            let isResizing = false;
            let resizeStartX = 0;
            let resizeStartY = 0;
            let resizeStartWidth = 0;
            let resizeStartHeight = 0;
            let resizeStartLeft = 0;
            let resizeStartTop = 0;
            let currentCorner = null;
            
            // Start dragging when mouse is pressed AND moved on navigation bar
            const popupNav = document.querySelector('.popup-nav');
            if (popupNav) {
                popupNav.addEventListener('mousedown', startDrag);
            } else {
                console.warn('Navigation bar not found. Dragging disabled.');
            }
            
            // Prevent dragging when clicking on filename text
            const popupFilenameElement = document.getElementById('popup-filename');
            if (popupFilenameElement) {
                popupFilenameElement.addEventListener('mousedown', (e) => {
                    e.stopPropagation(); // Prevent drag from starting
                });
            }
            
            // Start resizing when clicking on corner handles
            const resizeHandles = document.querySelectorAll('.resize-handle');
            if (resizeHandles.length > 0) {
                resizeHandles.forEach(handle => {
                    handle.addEventListener('mousedown', startResize);
                });
            } else {
                console.warn('No resize handles found. Resize functionality disabled.');
            }
            
            function startDrag(e) {
                // Don't start drag if clicking on buttons, filename, or resize handles
                if (e.target.closest('.popup-actions') || 
                    e.target.id === 'popup-filename' ||
                    e.target.closest('.resize-handle')) {
                    return;
                }
                
                // Only allow dragging from the navigation bar background area
                if (!e.target.closest('.popup-nav') || e.target.closest('.wrapper-actions')) {
                    return;
                }
                
                // Start dragging immediately (macOS-style)
                isDragging = true;
                
                // Get current popup position and mouse position
                const rect = imagePopup.getBoundingClientRect();
                popupStartX = rect.left;
                popupStartY = rect.top;
                dragStartX = e.clientX;
                dragStartY = e.clientY;
                
                // Use utility to add dragging state
                popupUtils.addDraggingState(imagePopup);
                
                // Add event listeners for dragging
                document.addEventListener('mousemove', drag);
                document.addEventListener('mouseup', stopDrag);
                
                // Prevent text selection during drag
                e.preventDefault();
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                // Calculate new position
                const deltaX = e.clientX - dragStartX;
                const deltaY = e.clientY - dragStartY;
                
                const newX = popupStartX + deltaX;
                const newY = popupStartY + deltaY;
                
                // Use utility to set position with bounds checking
                popupUtils.setPosition(imagePopup, newX, newY);
            }
            
            function stopDrag() {
                isDragging = false;
                document.removeEventListener('mousemove', drag);
                document.removeEventListener('mouseup', stopDrag);
                
                // Use utility to remove dragging state
                popupUtils.removeDraggingState(imagePopup);
            }
            
            // Resize functionality
            function startResize(e) {
                e.preventDefault();
                e.stopPropagation();
                
                isResizing = true;
                currentCorner = e.target.id;
                resizeStartX = e.clientX;
                resizeStartY = e.clientY;
                
                const rect = imagePopup.getBoundingClientRect();
                resizeStartWidth = rect.width;
                resizeStartHeight = rect.height;
                resizeStartLeft = rect.left;
                resizeStartTop = rect.top;
                
                // Use CSS class to disable animations during resize
                imagePopup.classList.add('resizing');
                
                document.addEventListener('mousemove', resize);
                document.addEventListener('mouseup', stopResize);
            }
            
            // Calculate minimum popup size needed to display full image with padding
            function calculateMinimumPopupSize() {
                const img = popupImage;
                if (!img || !img.complete) return { width: POPUP_CONFIG.minSize, height: POPUP_CONFIG.minSize };
                
                const basePadding = 40; // 20px on each side (20px * 2) - minimum padding
                const navigationBarHeight = 60; // Navigation bar height
                
                // macOS Preview approach: Image + padding must ALWAYS be visible
                // Calculate the minimum size needed to show the full image with base padding
                let minWidth = img.naturalWidth + basePadding;
                let minHeight = img.naturalHeight + basePadding + navigationBarHeight;
                
                // Ensure minimum size is respected
                minWidth = Math.max(minWidth, POPUP_CONFIG.minSize);
                minHeight = Math.max(minHeight, POPUP_CONFIG.minSize);
                
                return { width: minWidth, height: minHeight };
            }
            
            // Calculate optimal popup size based on image dimensions and viewport
            function calculateOptimalPopupSize(imageWidth, imageHeight, imageMinSize, viewportWidth, viewportHeight) {
                // macOS Preview approach: Simple, comfortable sizing with proper margins
                const margin = 80; // 40px on each side for comfortable breathing room
                const maxWidth = viewportWidth - margin;
                const maxHeight = viewportHeight - margin;
                
                // Calculate image aspect ratio
                const imageAspectRatio = imageWidth / imageHeight;
                
                // Simple approach: fit the image within the available space while maintaining aspect ratio
                let popupWidth, popupHeight;
                
                if (imageAspectRatio > 1) {
                    // Wide image - fit to available width
                    popupWidth = Math.min(imageWidth, maxWidth);
                    popupHeight = popupWidth / imageAspectRatio;
                    
                    // If height exceeds available height, scale down proportionally
                    if (popupHeight > maxHeight) {
                        popupHeight = maxHeight;
                        popupWidth = popupHeight * imageAspectRatio;
                    }
                } else {
                    // Tall image - fit to available height
                    popupHeight = Math.min(imageHeight, maxHeight);
                    popupWidth = popupHeight * imageAspectRatio;
                    
                    // If width exceeds available width, scale down proportionally
                    if (popupWidth > maxWidth) {
                        popupWidth = maxWidth;
                        popupHeight = popupWidth / imageAspectRatio;
                    }
                }
                
                // Ensure we meet minimum size requirements, but don't exceed viewport
                popupWidth = Math.max(popupWidth, imageMinSize.width);
                popupHeight = Math.max(popupHeight, imageMinSize.height);
                
                // Critical: If minimum size exceeds viewport, scale down proportionally
                // This ensures the popup never goes beyond viewport bounds
                if (popupWidth > maxWidth || popupHeight > maxHeight) {
                    // Calculate scale factor to fit within viewport
                    const scaleX = maxWidth / popupWidth;
                    const scaleY = maxHeight / popupHeight;
                    const scale = Math.min(scaleX, scaleY);
                    
                    // Apply scale while maintaining aspect ratio
                    popupWidth = popupWidth * scale;
                    popupHeight = popupHeight * scale;
                }
                
                // Final bounds check - ensure we don't exceed viewport (safety check)
                popupWidth = Math.min(popupWidth, maxWidth);
                popupHeight = Math.min(popupHeight, maxHeight);
                
                return {
                    width: Math.round(popupWidth),
                    height: Math.round(popupHeight)
                };
            }
            
            function resize(e) {
                if (!isResizing) return;
                
                // macOS Preview-style resizing: smooth 1:1 mouse tracking
                const deltaX = e.clientX - resizeStartX;
                const deltaY = e.clientY - resizeStartY;
                
                let newWidth = resizeStartWidth;
                let newHeight = resizeStartHeight;
                let newLeft = resizeStartLeft;
                let newTop = resizeStartTop;
                

                
                // macOS Preview behavior: opposite corner is always the anchor
                switch (currentCorner) {
                    case 'resize-se': // Bottom-right: upper-left anchor
                        newWidth = resizeStartWidth + deltaX;
                        newHeight = resizeStartHeight + deltaY;
                        // Left and top stay fixed (upper-left anchor)
                        break;
                        
                    case 'resize-sw': // Bottom-left: upper-right anchor
                        newWidth = resizeStartWidth - deltaX;
                        newHeight = resizeStartHeight + deltaY;
                        // Top stays fixed, left moves (upper-right anchor)
                        newLeft = resizeStartLeft + deltaX;
                        break;
                        
                    case 'resize-ne': // Top-right: lower-left anchor
                        newWidth = resizeStartWidth + deltaX;
                        newHeight = resizeStartHeight + deltaY; // Fixed: removed negative sign
                        // Left stays fixed, top moves (lower-left anchor)
                        newTop = resizeStartTop + deltaY;
                        break;
                        
                    case 'resize-nw': // Top-left: lower-right anchor
                        newWidth = resizeStartWidth - deltaX;
                        newHeight = resizeStartHeight + deltaY; // Fixed: removed negative sign
                        // Both left and top move (lower-right anchor)
                        newLeft = resizeStartLeft + deltaX;
                        newTop = resizeStartTop + deltaY;
                        break;
                }
                
                // macOS Preview-style constraints: Content-aware and smooth
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                
                // macOS Preview approach: Simple, effective resize constraints
                const imageAspectRatio = popupImage.naturalWidth / popupImage.naturalHeight;
                
                // Basic minimum size to prevent popup from being too small
                const minWidth = 300; // Minimum width for comfortable viewing
                const minHeight = 300; // Minimum height for comfortable viewing
                
                // Apply basic minimum size constraints
                newWidth = Math.max(minWidth, newWidth);
                newHeight = Math.max(minHeight, newHeight);
                
                // Simple resize - no complex aspect ratio maintenance
                // This allows flexible resizing like macOS Preview
                
                // macOS Preview approach: Keep popup within viewport bounds
                // Ensure the popup never goes outside the viewport
                if (newLeft + newWidth > viewportWidth) {
                    newWidth = viewportWidth - newLeft;
                }
                
                if (newTop + newHeight > viewportHeight) {
                    newHeight = viewportHeight - newTop;
                }
                
                // Handle negative positions (simple clamping like macOS Preview)
                if (newLeft < 0) {
                    newLeft = 0;
                }
                
                if (newTop < 0) {
                    newTop = 0;
                }
                

                
                // Apply new size and position (macOS Preview smooth)
                imagePopup.style.width = newWidth + 'px';
                imagePopup.style.height = newHeight + 'px';
                imagePopup.style.left = newLeft + 'px';
                imagePopup.style.top = newTop + 'px';
                imagePopup.style.transform = 'none';
                

            }
            
            function stopResize() {
                isResizing = false;
                currentCorner = null;
                document.removeEventListener('mousemove', resize);
                document.removeEventListener('mouseup', stopResize);
                
                // Remove resizing class to restore animations
                imagePopup.classList.remove('resizing');
            }
        </script>
    </body>
</html>
